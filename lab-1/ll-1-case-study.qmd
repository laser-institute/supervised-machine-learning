---
title: 'Machine Learning - Learning Lab 1'
subtitle: "Case Study - Foundations"
format: html
editor: visual
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

set.seed(20240706) # so the results are readily reproducible
```

## 1. PREPARE

We will be using data from the [IPEDS, the Integrated Postsecondary Education Data System](https://nces.ed.gov/ipeds/).

```{r}
library(tidyverse)
library(janitor)

ipeds <- read_csv("data/ipeds-all-title-9-2022-data.csv")

ipeds <- janitor::clean_names(ipeds)

glimpse(ipeds)
```

## 2. WRANGLE

```{r}

ipeds <- ipeds %>% 
    select(name = institution_name, 
           title_iv = hd2022_postsecondary_and_title_iv_institution_indicator, 
           carnegie_class = hd2022_carnegie_classification_2021_basic, 
           state = hd2022_state_abbreviation, 
           total_enroll = drvef2022_total_enrollment,
           pct_admitted = drvadm2022_percent_admitted_total,
           n_bach = drvc2022_bachelors_degree,
           n_mast = drvc2022_masters_degree,
           n_doc = drvc2022_doctors_degree_research_scholarship,
           tuition_fees = drvic2022_tuition_and_fees_2021_22,
           grad_rate = drvgr2022_graduation_rate_total_cohort,
           percent_fin_aid = sfa2122_percent_of_full_time_first_time_undergraduates_awarded_any_financial_aid,
           avg_salary = drvhr2022_average_salary_equated_to_9_months_of_full_time_instructional_staff_all_ranks)

ipeds %>% 
    count(title_iv)

ipeds <- ipeds %>% 
    filter(title_iv == "Title IV postsecondary institution")

ipeds %>% 
    count(carnegie_class)

ipeds <- ipeds %>% 
    filter(carnegie_class != "Not applicable, not in Carnegie universe (not accredited or nondegree-granting)")

ipeds %>% 
    skimr::skim()

ipeds %>% 
    glimpse()

ipeds <- ipeds %>% 
    select(-title_iv, -state)
```

#### **ðŸ‘‰ Your Turn** **â¤µ**

```{r}

```

## 3. EXPLORE

```{r}
ipeds
```

## 4. MODEL

```{r}
library(tidyverse)
library(tidymodels)

ipeds %>% glimpse()

ipeds <- ipeds %>% select(grad_rate, everything())

ipeds %>% glimpse()

ipeds <- ipeds %>% 
    mutate(n_grad = n_mast + n_doc)


ipeds %>% 
    skimr::skim()

ipeds <- ipeds %>% 
    mutate(good_grad_rate = if_else(grad_rate > 65, 1, 0),
           good_grad_rate = as.factor(good_grad_rate))

train_test_split <- initial_split(ipeds, prop = .80)
data_train <- training(train_test_split)

ipeds %>% 
    write_csv("data/ipeds-processed.csv")

my_rec <- recipe(good_grad_rate ~ total_enroll + pct_admitted + n_bach + n_grad + tuition_fees + percent_fin_aid + avg_salary, data = data_train) %>% 
    step_normalize(all_numeric_predictors())

# specify model
my_mod <-
    logistic_reg() %>% 
    set_engine("glm") %>%
    set_mode("classification")

my_wf <-
    workflow() %>%
    add_model(my_mod) %>% 
    add_recipe(my_rec)

class_metrics <- metric_set(accuracy, sensitivity, specificity, ppv, npv, kap) # this is new

final_fit <- last_fit(my_wf, train_test_split, metrics = class_metrics)

final_fit

extract_fit_parsnip(final_fit) %>% 
    tidy() %>% 
    arrange(desc(estimate))

final_fit %>%
    collect_metrics()


```

## 5. COMMUNICATE

For now, let's keep our task relatively straightforward. How well do our
names seem to characterize what is going on in a particular segment? Add
a few notes below. Again, focus on what you would communicate about this
analysis to a general audience.

-   ADD YOUR RESPONSE HERE

-   ADD YOUR RESPONSE HERE

### ðŸ§¶ Knit & Check âœ…

Congratulations - you've completed this case study! Consider moving on
to the badge activity next.
