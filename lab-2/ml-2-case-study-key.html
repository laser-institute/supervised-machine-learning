<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="LASER Institute">
<meta name="dcterms.date" content="2024-07-15">

<title>Predicting Student Success</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="ml-2-case-study-key_files/libs/clipboard/clipboard.min.js"></script>
<script src="ml-2-case-study-key_files/libs/quarto-html/quarto.js"></script>
<script src="ml-2-case-study-key_files/libs/quarto-html/popper.min.js"></script>
<script src="ml-2-case-study-key_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="ml-2-case-study-key_files/libs/quarto-html/anchor.min.js"></script>
<link href="ml-2-case-study-key_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="ml-2-case-study-key_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="ml-2-case-study-key_files/libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="ml-2-case-study-key_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="ml-2-case-study-key_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="ml-2-case-study-key_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="ml-2-case-study-key_files/libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#prepare" id="toc-prepare" class="nav-link active" data-scroll-target="#prepare">1. PREPARE</a>
  <ul>
  <li><a href="#a.-conceptual-focus" id="toc-a.-conceptual-focus" class="nav-link" data-scroll-target="#a.-conceptual-focus">1a. Conceptual Focus</a>
  <ul class="collapse">
  <li><a href="#research-question" id="toc-research-question" class="nav-link" data-scroll-target="#research-question">Research Question</a></li>
  <li><a href="#reading-1-statistical-modeling-the-two-cultures" id="toc-reading-1-statistical-modeling-the-two-cultures" class="nav-link" data-scroll-target="#reading-1-statistical-modeling-the-two-cultures">Reading 1: Statistical modeling: The two cultures</a></li>
  <li><a href="#your-turn" id="toc-your-turn" class="nav-link" data-scroll-target="#your-turn"><strong>ğŸ‘‰ Your Turn</strong> <strong>â¤µ</strong></a></li>
  </ul></li>
  <li><a href="#b.-load-packages" id="toc-b.-load-packages" class="nav-link" data-scroll-target="#b.-load-packages">1b. Load Packages</a>
  <ul class="collapse">
  <li><a href="#tidyverse" id="toc-tidyverse" class="nav-link" data-scroll-target="#tidyverse">tidyverse ğŸ“¦</a></li>
  <li><a href="#tidymodels" id="toc-tidymodels" class="nav-link" data-scroll-target="#tidymodels"><strong>tidymodels ğŸ“¦</strong></a></li>
  <li><a href="#your-turn-1" id="toc-your-turn-1" class="nav-link" data-scroll-target="#your-turn-1"><strong>ğŸ‘‰ Your Turn</strong> <strong>â¤µ</strong></a></li>
  </ul></li>
  </ul></li>
  <li><a href="#wrangle" id="toc-wrangle" class="nav-link" data-scroll-target="#wrangle">2. WRANGLE</a>
  <ul>
  <li><a href="#a.-import-and-inspect-data" id="toc-a.-import-and-inspect-data" class="nav-link" data-scroll-target="#a.-import-and-inspect-data">1a. Import and Inspect Data</a>
  <ul class="collapse">
  <li><a href="#your-turn-2" id="toc-your-turn-2" class="nav-link" data-scroll-target="#your-turn-2"><strong>ğŸ‘‰ Your Turn</strong> <strong>â¤µ</strong></a></li>
  <li><a href="#read-csv-data-file" id="toc-read-csv-data-file" class="nav-link" data-scroll-target="#read-csv-data-file">Read CSV Data File</a></li>
  <li><a href="#your-turn-3" id="toc-your-turn-3" class="nav-link" data-scroll-target="#your-turn-3"><strong>ğŸ‘‰ Your Turn</strong> <strong>â¤µ</strong></a></li>
  <li><a href="#inspect-data" id="toc-inspect-data" class="nav-link" data-scroll-target="#inspect-data">Inspect Data</a></li>
  </ul></li>
  <li><a href="#b.-mutate-variables" id="toc-b.-mutate-variables" class="nav-link" data-scroll-target="#b.-mutate-variables">2b. â€œMutateâ€ Variables</a>
  <ul class="collapse">
  <li><a href="#your-turn-4" id="toc-your-turn-4" class="nav-link" data-scroll-target="#your-turn-4"><strong>ğŸ‘‰ Your Turn</strong> <strong>â¤µ</strong></a></li>
  </ul></li>
  </ul></li>
  <li><a href="#explore" id="toc-explore" class="nav-link" data-scroll-target="#explore">3. EXPLORE</a>
  <ul>
  <li><a href="#a.-examine-variables" id="toc-a.-examine-variables" class="nav-link" data-scroll-target="#a.-examine-variables">3a. Examine Variables</a></li>
  <li><a href="#b.-feature-engineering" id="toc-b.-feature-engineering" class="nav-link" data-scroll-target="#b.-feature-engineering">3b. Feature Engineering</a>
  <ul class="collapse">
  <li><a href="#student-socioeconomic-index" id="toc-student-socioeconomic-index" class="nav-link" data-scroll-target="#student-socioeconomic-index">Student Socioeconomic Index</a></li>
  <li><a href="#your-turn-5" id="toc-your-turn-5" class="nav-link" data-scroll-target="#your-turn-5"><strong>ğŸ‘‰ Your Turn</strong> <strong>â¤µ</strong></a></li>
  </ul></li>
  </ul></li>
  <li><a href="#model" id="toc-model" class="nav-link" data-scroll-target="#model">4. MODEL</a>
  <ul>
  <li><a href="#step-1.-split-data" id="toc-step-1.-split-data" class="nav-link" data-scroll-target="#step-1.-split-data">Step 1. Split data</a>
  <ul class="collapse">
  <li><a href="#training-and-testing-sets" id="toc-training-and-testing-sets" class="nav-link" data-scroll-target="#training-and-testing-sets">Training and Testing Sets</a></li>
  <li><a href="#split-data-sets" id="toc-split-data-sets" class="nav-link" data-scroll-target="#split-data-sets">Split Data Sets</a></li>
  <li><a href="#your-turn-6" id="toc-your-turn-6" class="nav-link" data-scroll-target="#your-turn-6"><strong>ğŸ‘‰ Your Turn</strong> <strong>â¤µ</strong></a></li>
  </ul></li>
  <li><a href="#step-2-create-a-recipe" id="toc-step-2-create-a-recipe" class="nav-link" data-scroll-target="#step-2-create-a-recipe">Step 2: Create a â€œRecipeâ€</a>
  <ul class="collapse">
  <li><a href="#add-a-formula" id="toc-add-a-formula" class="nav-link" data-scroll-target="#add-a-formula"><strong>Add a formula</strong></a></li>
  </ul></li>
  <li><a href="#step-3-specify-the-model-and-workflow" id="toc-step-3-specify-the-model-and-workflow" class="nav-link" data-scroll-target="#step-3-specify-the-model-and-workflow">Step 3: Specify the model and workflow</a>
  <ul class="collapse">
  <li><a href="#start-your-engine" id="toc-start-your-engine" class="nav-link" data-scroll-target="#start-your-engine"><strong>Start your engine</strong></a></li>
  <li><a href="#add-to-workflow" id="toc-add-to-workflow" class="nav-link" data-scroll-target="#add-to-workflow"><strong>Add to workflow</strong></a></li>
  </ul></li>
  <li><a href="#step-4-fit-model" id="toc-step-4-fit-model" class="nav-link" data-scroll-target="#step-4-fit-model">Step 4: Fit model</a>
  <ul class="collapse">
  <li><a href="#your-turn-7" id="toc-your-turn-7" class="nav-link" data-scroll-target="#your-turn-7"><strong>ğŸ‘‰ Your Turn</strong> <strong>â¤µ</strong></a></li>
  <li><a href="#the-last_fit-function" id="toc-the-last_fit-function" class="nav-link" data-scroll-target="#the-last_fit-function">The last_fit function</a></li>
  </ul></li>
  <li><a href="#step-5-interpret-accuracy" id="toc-step-5-interpret-accuracy" class="nav-link" data-scroll-target="#step-5-interpret-accuracy">Step 5: Interpret accuracy</a>
  <ul class="collapse">
  <li><a href="#your-turn-8" id="toc-your-turn-8" class="nav-link" data-scroll-target="#your-turn-8"><strong>ğŸ‘‰ Your Turn</strong> <strong>â¤µ</strong></a></li>
  </ul></li>
  </ul></li>
  <li><a href="#communicate" id="toc-communicate" class="nav-link" data-scroll-target="#communicate">5. COMMUNICATE</a>
  <ul>
  <li><a href="#your-turn-9" id="toc-your-turn-9" class="nav-link" data-scroll-target="#your-turn-9"><strong>ğŸ‘‰ Your Turn</strong> <strong>â¤µ</strong></a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Predicting Student Success</h1>
<p class="subtitle lead">ML Module 2: Case Study Key</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>LASER Institute </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 15, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="prepare" class="level2">
<h2 class="anchored" data-anchor-id="prepare">1. PREPARE</h2>
<p>Each machine learning â€œcase studyâ€ is designed to illustrate how machine learning methods and techniques can be applied to address a research question of interest, create useful data products, and conduct reproducible research. Each case study is structured around a basic analytics workflow modeled after the Data-Intensive Research Workflow from <a href="#0">Learning Analytics Goes to School</a>&nbsp;(Krumm et al., 2018):</p>
<p><img src="https://sbkellogg.github.io/eci-589/unit-1/img/workflow.png" class="img-fluid" style="width:80.0%" alt=""></p>
<p>Figure 2.2 Steps of Data-Intensive Research Workflow</p>
<p>In the overview presentation for this learning module, we considered five steps in our supervised machine learning process. Those steps are mirrored here in this case study, with the addition of some other components of this workflow. For example, to help prepare for analysis, weâ€™ll first take a step back and think about how we want to use machine learning, and <em>predicting</em> is a key word. Many scholars have focused on predicting students who are <em>at-risk</em>: of dropping a course or not succeeding in it. In the ML Learning module 1 case study will cover the following workflow topics as we attempt to develop our own model for predicting student drop-out:</p>
<ol type="1">
<li><p><strong>Prepare</strong>: Prior to analysis, weâ€™ll look at the context from which our data came, formulate a basic research question, and get introduced the {tidymodels} packages for machine learning.</p></li>
<li><p><strong>Wrangle</strong>: Wrangling data entails the work of cleaning, transforming, and merging data. In Part 2 we focus on importing CSV files and modifying some of our variables.</p></li>
<li><p><strong>Explore</strong>: We take a quick look at our variables of interest and do some basic â€œfeature engineeringâ€ by creating some new variables we think will be predictive of students at risk.</p></li>
<li><p><strong>Model:</strong> We dive deeper into the five steps in our supervised machine learning process, focusing on the mechanics of <strong>making predictions</strong>.</p></li>
<li><p><strong>Communicate:</strong> To wrap up our case study, weâ€™ll create our first â€œdata productâ€ and share our analyses and findings by creating our first web page using R Markdown.</p></li>
</ol>
<section id="a.-conceptual-focus" class="level3">
<h3 class="anchored" data-anchor-id="a.-conceptual-focus">1a. Conceptual Focus</h3>
<p>Conceptually, we focus on prediction and how it differs from the goals of description or explanation. We have two readings in Learning module 1 that accompany this. The first reading introduced below focuses on this distinction between prediction and description or explanation. It is one of the most widely-read papers in machine learning and articulates how machine learning differs from other kinds of statistical models. Breiman describes the difference in terms of <em>data modeling</em> (models for description and explanation) and <em>algorithmic modeling</em> (what we call prediction or machine learning models)*</p>
<section id="research-question" class="level4">
<h4 class="anchored" data-anchor-id="research-question">Research Question</h4>
<p>Technically, weâ€™ll focus on the core parts of doing a machine learning analysis in R. Weâ€™ll use the {<a href="https://www.tidymodels.org/">tidymodels</a>} set of R packages (add-ons) to do so. However, to help anchor our analysis and provide us with some direction, weâ€™ll focus on the following research question as we explore this new:</p>
<blockquote class="blockquote">
<p>How well can we predict students who are at risk of dropping a course?</p>
</blockquote>
</section>
<section id="reading-1-statistical-modeling-the-two-cultures" class="level4">
<h4 class="anchored" data-anchor-id="reading-1-statistical-modeling-the-two-cultures">Reading 1: Statistical modeling: The two cultures</h4>
<p><img src="img/breiman.png" class="img-fluid" style="width:50.0%"></p>
<p>Breiman, L. (2001). Statistical modeling: The two cultures (with comments and a rejoinder by the author). <em>Statistical Science, 16</em>(3), 199-231. <a href="https://projecteuclid.org/journals/statistical-science/volume-16/issue-3/Statistical-Modeling--The-Two-Cultures-with-comments-and-a/10.1214/ss/1009213726.pdf" class="uri">https://projecteuclid.org/journals/statistical-science/volume-16/issue-3/Statistical-Modeling--The-Two-Cultures-with-comments-and-a/10.1214/ss/1009213726.pdf</a></p>
<p><strong>Abstract</strong></p>
<p>There are two cultures in the use of statistical modeling to reach conclusions from data. One assumes that the data are generated by a given stochastic data model. The other uses algorithmic models and treats the data mechanism as unknown. The statistical community has been committed to the almost exclusive use of data models. This commitment has led to irrelevant theory, questionable conclusions, and has kept statisticians from working on a large range of interesting current problems. Algorithmic modeling, both in theory and practice, has developed rapidly in fields outside statistics. It can be used both on large complex data sets and as a more accurate and informative alternative to data modeling on smaller data sets. If our goal as a field is to use data to solve problems, then we need to move away from exclusive dependence on data models and adopt a more diverse set of tools.</p>
</section>
<section id="your-turn" class="level4">
<h4 class="anchored" data-anchor-id="your-turn"><strong>ğŸ‘‰ Your Turn</strong> <strong>â¤µ</strong></h4>
<p>Youâ€™ll be asked to reflect more deeply on this article later on (in the badge activity); but for now, open up the article and take quick scan of the article and note below an observation or question you have about the article.</p>
<ul>
<li>YOUR RESPONSE HERE</li>
</ul>
</section>
</section>
<section id="b.-load-packages" class="level3">
<h3 class="anchored" data-anchor-id="b.-load-packages">1b. Load Packages</h3>
<p>As highlighted in&nbsp;<a href="https://datascienceineducation.com/c06.html">Chapter 6 of Data Science in Education Using R</a>&nbsp;(DSIEUR), one of the first steps of every workflow should be to set up your â€œProjectâ€ within RStudio. Recall that:</p>
<blockquote class="blockquote">
<p>A <strong>Project</strong> is the home for all of the files, images, reports, and code that are used in any given project</p>
</blockquote>
<p>Since we are working from an R project cloned from <a href="https://github.com/laser-institute">GitHub</a>, a Project has already been set up for you as indicated by the <code>.Rproj</code> file in your main directory in the Files pane. Instead, we will focus on getting our project set up withe the requisite packages weâ€™ll need for analysis.</p>
<p><strong>Packages</strong>, sometimes called libraries, are shareable collections of R code that can contain functions, data, and/or documentation and extend the functionality of R. You can always check to see which packages have already been installed and loaded into RStudio Cloud by looking at the the Files, Plots, &amp; Packages Pane in the lower right-hand corner.</p>
<p>Two packages weâ€™ll use extensively throughout these learning labs are the {tidyverse} and {tidymodels} packages.</p>
<section id="tidyverse" class="level4">
<h4 class="anchored" data-anchor-id="tidyverse">tidyverse ğŸ“¦</h4>
<p><img src="img/tidyverse.png" class="img-fluid" style="width:20.0%"></p>
<p>One package that weâ€™ll be using extensively throughout LASER is the {tidyverse} package. Recall from earlier tutorials that the {tidyverse} package is actually a <a href="https://www.tidyverse.org/packages">collection of R packages</a> designed for reading, wrangling, and exploring data and which all share an underlying design philosophy, grammar, and data structures. These shared features are sometimes â€œtidy data principles.â€</p>
<p>Click the green arrow in the right corner of the â€œcode chunkâ€ that follows to load the {tidyverse} library.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>â”€â”€ Attaching core tidyverse packages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse 2.0.0 â”€â”€
âœ” dplyr     1.1.4     âœ” readr     2.1.5
âœ” forcats   1.0.0     âœ” stringr   1.5.1
âœ” ggplot2   3.5.1     âœ” tibble    3.2.1
âœ” lubridate 1.9.3     âœ” tidyr     1.3.1
âœ” purrr     1.0.2     
â”€â”€ Conflicts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse_conflicts() â”€â”€
âœ– dplyr::filter() masks stats::filter()
âœ– dplyr::lag()    masks stats::lag()
â„¹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
</div>
</section>
<section id="tidymodels" class="level4">
<h4 class="anchored" data-anchor-id="tidymodels"><strong>tidymodels ğŸ“¦</strong></h4>
<p><a href="https://www.tidymodels.org/"><img src="img/tidymodels.png" class="img-fluid" style="width:20.0%"></a></p>
<p>The <a href="https://www.tidymodels.org/">tidymodels</a> package is a â€œmeta-packageâ€ for modeling and statistical analysis that shares the underlying design philosophy, grammar, and data structures of the <a href="https://www.tidyverse.org/">tidyverse</a>. It includes a core set of packages that are loaded on startup and contains tools for:</p>
<ul>
<li><p>data splitting and pre-processing;</p></li>
<li><p>model selection, tuning, and evaluation;</p></li>
<li><p>feature selection and variable importance estimation;</p></li>
<li><p>as well as other functionality.</p></li>
</ul>
</section>
<section id="your-turn-1" class="level4">
<h4 class="anchored" data-anchor-id="your-turn-1"><strong>ğŸ‘‰ Your Turn</strong> <strong>â¤µ</strong></h4>
<p>In addition to the {tidymodels} package, weâ€™ll also be using the lightweight but highly useful {janitor} package to help with some data cleaning tasks. Use the code chunk below to load these two packages:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>â”€â”€ Attaching packages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidymodels 1.2.0 â”€â”€</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>âœ” broom        1.0.6     âœ” rsample      1.2.1
âœ” dials        1.2.1     âœ” tune         1.2.1
âœ” infer        1.0.7     âœ” workflows    1.1.4
âœ” modeldata    1.4.0     âœ” workflowsets 1.1.0
âœ” parsnip      1.2.1     âœ” yardstick    1.3.1
âœ” recipes      1.1.0     </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>â”€â”€ Conflicts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidymodels_conflicts() â”€â”€
âœ– scales::discard() masks purrr::discard()
âœ– dplyr::filter()   masks stats::filter()
âœ– recipes::fixed()  masks stringr::fixed()
âœ– dplyr::lag()      masks stats::lag()
âœ– yardstick::spec() masks readr::spec()
âœ– recipes::step()   masks stats::step()
â€¢ Search for functions across packages at https://www.tidymodels.org/find/</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'janitor'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    chisq.test, fisher.test</code></pre>
</div>
</div>
<p>As a tip, remember to use the <code>library()</code> function to load these packages. After youâ€™ve done that, click the green arrow to run the code chunk. If you see a bunch of messages (not anything labeled as an error), you are good to go! These messages mean the packages loaded correctly.</p>
</section>
</section>
</section>
<section id="wrangle" class="level2">
<h2 class="anchored" data-anchor-id="wrangle">2. WRANGLE</h2>
<p>In general, data wrangling involves some combination of cleaning, reshaping, transforming, and merging data (Wickham &amp; Grolemund, 2017). The importance of data wrangling is difficult to overstate, as it involves the initial steps of going from raw data to a dataset that can be explored and modeled (Krumm et al, 2018). In Part 2, we focus on the the following wrangling processes to:</p>
<ol type="1">
<li><p><strong>Importing and Inspecting Data</strong>. In this section, we will â€œreadâ€ in our CSV data file and take a quick look at what our file contains.</p></li>
<li><p><strong>Mutate Variables</strong>. We use the <code>mutate()</code> function to create a dichotomous variable for whether or not the student withdrew from the course.</p></li>
</ol>
<section id="a.-import-and-inspect-data" class="level3">
<h3 class="anchored" data-anchor-id="a.-import-and-inspect-data">1a. Import and Inspect Data</h3>
<p>For learning labs 1-3, weâ€™ll be using a widely-used data set in the learning analytics field: the <a href="https://analyse.kmi.open.ac.uk/open_dataset">Open University Learning Analytics Dataset (OULAD)</a>. The OULAD was created by learning analytics researchers at the United Kingdom-based Open University. It includes data from post-secondary learners participation in one of several Massive Open Online Courses (called <em>modules</em> in the OULAD).</p>
<blockquote class="blockquote">
<p>Kuzilek, J., Hlosta, M., &amp; Zdrahal, Z. (2017). Open university learning analytics dataset. <em>Scientific Data, 4(</em>1), 1-8. <a href="https://www.nature.com/articles/sdata2017171" class="uri">https://www.nature.com/articles/sdata2017171</a></p>
</blockquote>
<p><strong>Abstract</strong></p>
<p>Learning Analytics focuses on the collection and analysis of learnersâ€™ data to improve their learning experience by providing informed guidance and to optimise learning materials. To support the research in this area we have developed a dataset, containing data from courses presented at the Open University (OU). What makes the dataset unique is the fact that it contains demographic data together with aggregated clickstream data of studentsâ€™ interactions in the Virtual Learning Environment (VLE). This enables the analysis of student behavior, represented by their actions. The dataset contains the information about 22 courses, 32,593 students, their assessment results, and logs of their interactions with the VLE represented by daily summaries of student clicks (10,655,280 entries). The dataset is freely available at <a href="https://analyse.kmi.open.ac.uk/open_dataset" class="uri">https://analyse.kmi.open.ac.uk/open_dataset</a> under a CC-BY 4.0 license.</p>
<section id="your-turn-2" class="level4">
<h4 class="anchored" data-anchor-id="your-turn-2"><strong>ğŸ‘‰ Your Turn</strong> <strong>â¤µ</strong></h4>
<p>You donâ€™t need to read the entire article yet, but please open this article, scan the sections, and write down two things you notice or wonder about the dataset.</p>
<ol type="1">
<li><p>YOUR RESPONSE HERE</p></li>
<li><p>YOUR RESPONSE HERE</p></li>
</ol>
</section>
<section id="read-csv-data-file" class="level4">
<h4 class="anchored" data-anchor-id="read-csv-data-file">Read CSV Data File</h4>
<p>The data can be downloaded at the above link; however, for our purposes, they are already downloaded to the <code>data</code> sub-folder.</p>
<p>Weâ€™ll use the <code>read_csv()</code> function to load the files â€“ two in total, with data on students and assessments. Note: we have done some minimal processing of these files to make getting us started easier. If youâ€™re interested in what weâ€™ve done, check out the <code>oulad.R</code> file in the <code>lab-1</code> folder.</p>
<p>For now, please read in the <code>oulad-students.csv</code> file. Use the <code>read_csv()</code> function to do this, paying attention to where those files are located relative to this case study file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>students <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/oulad-students.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 32593 Columns: 15
â”€â”€ Column specification â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Delimiter: ","
chr (9): code_module, code_presentation, gender, region, highest_education, ...
dbl (6): id_student, num_of_prev_attempts, studied_credits, module_presentat...

â„¹ Use `spec()` to retrieve the full column specification for this data.
â„¹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>You can see a description of the data <a href="https://analyse.kmi.open.ac.uk/open_dataset#description">here</a>. The students file includes three files joined together: studentInfo, courses, and studentRegistration. Take a look at the data description to get a sense for what variables are in which data frame.</p>
</section>
<section id="your-turn-3" class="level4">
<h4 class="anchored" data-anchor-id="your-turn-3"><strong>ğŸ‘‰ Your Turn</strong> <strong>â¤µ</strong></h4>
</section>
<section id="inspect-data" class="level4">
<h4 class="anchored" data-anchor-id="inspect-data">Inspect Data</h4>
<p>In the chunk below, examine the data set using a function or means of your choice (such as just <em>printing</em> the data set by typing its name or using the <code>glimpse()</code> function). Do this in the code chunk below! Note its dimensions â€” especially how many rows it has!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(students)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 32,593
Columns: 15
$ code_module                &lt;chr&gt; "AAA", "AAA", "AAA", "AAA", "AAA", "AAA", "â€¦
$ code_presentation          &lt;chr&gt; "2013J", "2013J", "2013J", "2013J", "2013J"â€¦
$ id_student                 &lt;dbl&gt; 11391, 28400, 30268, 31604, 32885, 38053, 4â€¦
$ gender                     &lt;chr&gt; "M", "F", "F", "F", "F", "M", "M", "F", "F"â€¦
$ region                     &lt;chr&gt; "East Anglian Region", "Scotland", "North Wâ€¦
$ highest_education          &lt;chr&gt; "HE Qualification", "HE Qualification", "A â€¦
$ imd_band                   &lt;chr&gt; "90-100%", "20-30%", "30-40%", "50-60%", "5â€¦
$ age_band                   &lt;chr&gt; "55&lt;=", "35-55", "35-55", "35-55", "0-35", â€¦
$ num_of_prev_attempts       &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0â€¦
$ studied_credits            &lt;dbl&gt; 240, 60, 60, 60, 60, 60, 60, 120, 90, 60, 6â€¦
$ disability                 &lt;chr&gt; "N", "N", "Y", "N", "N", "N", "N", "N", "N"â€¦
$ final_result               &lt;chr&gt; "Pass", "Pass", "Withdrawn", "Pass", "Pass"â€¦
$ module_presentation_length &lt;dbl&gt; 268, 268, 268, 268, 268, 268, 268, 268, 268â€¦
$ date_registration          &lt;dbl&gt; -159, -53, -92, -52, -176, -110, -67, -29, â€¦
$ date_unregistration        &lt;dbl&gt; NA, NA, 12, NA, NA, NA, NA, NA, NA, NA, NA,â€¦</code></pre>
</div>
</div>
<p>Write down a few observations after inspecting the data:</p>
<ul>
<li>YOUR RESPONSE HERE</li>
<li>YOUR RESPONSE HERE</li>
<li>YOUR RESPONSE HERE</li>
</ul>
</section>
</section>
<section id="b.-mutate-variables" class="level3">
<h3 class="anchored" data-anchor-id="b.-mutate-variables">2b. â€œMutateâ€ Variables</h3>
<p>Weâ€™re going to do a few more steps related to data wrangling here, noting we could also do these at later stages of our process (namely, in the feature engineering stage).</p>
<p>First, since we are interested in developing a model that can predict whether a student is at risk of dropping a course, and so we can intervene before that happens, we need an outcome variable that letâ€™s us know if they have passed.</p>
<p>To create this variable, letâ€™s use the <code>mutate()</code> function to create a dichotomous variable for whether or not the student withdrew from the course. Hereâ€™s a way we can do this, using <code>if_else()</code> and <code>as.factor()</code>. This will be our <em>outcome</em> variable, or the predicted variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>students <span class="ot">&lt;-</span> students <span class="sc">%&gt;%</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">pass =</span> <span class="fu">ifelse</span>(final_result <span class="sc">==</span> <span class="st">"Pass"</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span> <span class="co"># creates a new variable named "pass" and a dummy code of 1 if value of final_result equals "pass" and 0 if not</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">pass =</span> <span class="fu">as.factor</span>(pass)) <span class="co"># makes the variable a factor, helping later steps</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Note</strong>: The <a href="https://dplyr.tidyverse.org/reference/mutate.html#:~:text=mutate()%20creates%20new%20columns,setting%20their%20value%20to%20NULL%20"><code>mutate()</code> function</a>.) is a critical function to learn and is used to create new columns that are functions of existing variables. It can also modify (if the name is the same as an existing column) and delete columns (by setting their value to <code>NULL</code>).</p>
<p>Next, letâ€™s do something similar for whether a student identifies as having a disability. In this case, there are only two values for the disability variable, so we can simply convert it directly to a factor. Look at the code you used above, <em>modifying</em> it for the disability variable. This will be an <em>independent variable</em>, or a predictor variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>students <span class="ot">&lt;-</span> students <span class="sc">%&gt;%</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">disability =</span> <span class="fu">as.factor</span>(disability))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="your-turn-4" class="level4">
<h4 class="anchored" data-anchor-id="your-turn-4"><strong>ğŸ‘‰ Your Turn</strong> <strong>â¤µ</strong></h4>
<p>In the chunk below, use the <code>view()</code> function to manually check and see if our new variable has indeed been added to our data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">view</span>(students)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="explore" class="level2">
<h2 class="anchored" data-anchor-id="explore">3. EXPLORE</h2>
<p>As noted by Krumm et al.&nbsp;(2018), exploratory data analysis often involves some combination of data visualization and <em>feature engineering</em>. In Part 3, we will create a quick visualization to help us spot any potential issues with our data and engineer new predictive variables or â€œfeaturesâ€ that we will use in our predictive models. Specifically, in Part 3 we will:</p>
<ol type="1">
<li><p><strong>Examine Outcomes</strong> by taking a quick <code>count()</code> of the number of students and the number of specific offerings of each course module.</p></li>
<li><p><strong>Engineer Predictors</strong> by creating one more predictor variable based on a measure of socioeconomic resourcesâ€“the index of multiple depravity variable.</p></li>
</ol>
<section id="a.-examine-variables" class="level3">
<h3 class="anchored" data-anchor-id="a.-examine-variables">3a. Examine Variables</h3>
<p>A useful function for exploring data is <code>count()</code>; it does what it sounds like! It counts how many times values for a variable appear.</p>
<p>Referring to the <a href="https://analyse.kmi.open.ac.uk/open_dataset#description">data description</a>, in the chunk below, count the number of students. Also, count the number of courses (modules) and specific offerings (as modules can be offered multiple times per year). Learn more about <code>count()</code> <a href="https://dplyr.tidyverse.org/reference/count.html">here</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>students <span class="sc">%&gt;%</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(id_student) <span class="co"># this many students</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 28,785 Ã— 2
   id_student     n
        &lt;dbl&gt; &lt;int&gt;
 1       3733     1
 2       6516     1
 3       8462     2
 4      11391     1
 5      23629     1
 6      23632     1
 7      23698     1
 8      23798     1
 9      24186     1
10      24213     2
# â„¹ 28,775 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>students <span class="sc">%&gt;%</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(code_module, code_presentation) <span class="co"># this many offerings</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 22 Ã— 3
   code_module code_presentation     n
   &lt;chr&gt;       &lt;chr&gt;             &lt;int&gt;
 1 AAA         2013J               383
 2 AAA         2014J               365
 3 BBB         2013B              1767
 4 BBB         2013J              2237
 5 BBB         2014B              1613
 6 BBB         2014J              2292
 7 CCC         2014B              1936
 8 CCC         2014J              2498
 9 DDD         2013B              1303
10 DDD         2013J              1938
# â„¹ 12 more rows</code></pre>
</div>
</div>
</section>
<section id="b.-feature-engineering" class="level3">
<h3 class="anchored" data-anchor-id="b.-feature-engineering">3b. Feature Engineering</h3>
<p>As defined by Krumm, Means, and Bienkowski (2018) in <em>Learning Analytics Goes to School</em>:</p>
<blockquote class="blockquote">
<p><strong>Feature engineering</strong> is the process of creating new variables within a dataset, which goes above and beyond the work of recoding and rescaling variables.</p>
</blockquote>
<p>The authors note that feature engineering draws on substantive knowledge from theory or practice, experience with a particular data system, and general experience in data-intensive research. Moreover, these features can be used not only in machine learning models, but also in visualizations and tables comprising descriptive statistics.</p>
<p>Though not often discussed, feature engineering is an important element of data-intensive research that can generate new insights and improve predictive models. You can read more about feature engineering <a href="https://www.tmwr.org/recipes.html">here</a>.</p>
<section id="student-socioeconomic-index" class="level4">
<h4 class="anchored" data-anchor-id="student-socioeconomic-index">Student Socioeconomic Index</h4>
<p>For our first module, weâ€™ll engage in a very basic feature engineering step, though weâ€™ll do this <em>much</em> more in the next learning lab.</p>
<p>To do feature engineering, letâ€™s create one more predictor variable based on a measure of socioeconomic resourcesâ€“the index of multiple depravity variable. The process we take here is to turn this variable that is a character string into a number by creating a factor and then <em>coercing</em> it to an integer.</p>
</section>
<section id="your-turn-5" class="level4">
<h4 class="anchored" data-anchor-id="your-turn-5"><strong>ğŸ‘‰ Your Turn</strong> <strong>â¤µ</strong></h4>
<p>Please replace the ___ values in the code below with the correct variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>students <span class="ot">&lt;-</span> students <span class="sc">%&gt;%</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">imd_band =</span> <span class="fu">factor</span>(imd_band, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"0-10%"</span>,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">"10-20%"</span>,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">"20-30%"</span>,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">"30-40%"</span>,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">"40-50%"</span>,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">"50-60%"</span>,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">"60-70%"</span>,</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">"70-80%"</span>,</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">"80-90%"</span>,</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">"90-100%"</span>))) <span class="sc">%&gt;%</span> <span class="co"># this creates a factor with ordered levels</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">imd_band =</span> <span class="fu">as.integer</span>(imd_band)) <span class="co"># this changes the levels into integers based on the order of the factor levels</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>students</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 32,593 Ã— 16
   code_module code_presentation id_student gender region      highest_education
   &lt;chr&gt;       &lt;chr&gt;                  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;       &lt;chr&gt;            
 1 AAA         2013J                  11391 M      East Angliâ€¦ HE Qualification 
 2 AAA         2013J                  28400 F      Scotland    HE Qualification 
 3 AAA         2013J                  30268 F      North Westâ€¦ A Level or Equivâ€¦
 4 AAA         2013J                  31604 F      South Eastâ€¦ A Level or Equivâ€¦
 5 AAA         2013J                  32885 F      West Midlaâ€¦ Lower Than A Levâ€¦
 6 AAA         2013J                  38053 M      Wales       A Level or Equivâ€¦
 7 AAA         2013J                  45462 M      Scotland    HE Qualification 
 8 AAA         2013J                  45642 F      North Westâ€¦ A Level or Equivâ€¦
 9 AAA         2013J                  52130 F      East Angliâ€¦ A Level or Equivâ€¦
10 AAA         2013J                  53025 M      North Regiâ€¦ Post Graduate Quâ€¦
# â„¹ 32,583 more rows
# â„¹ 10 more variables: imd_band &lt;int&gt;, age_band &lt;chr&gt;,
#   num_of_prev_attempts &lt;dbl&gt;, studied_credits &lt;dbl&gt;, disability &lt;fct&gt;,
#   final_result &lt;chr&gt;, module_presentation_length &lt;dbl&gt;,
#   date_registration &lt;dbl&gt;, date_unregistration &lt;dbl&gt;, pass &lt;fct&gt;</code></pre>
</div>
</div>
<p>Weâ€™re now ready to proceed to the five machine learning steps!</p>
</section>
</section>
</section>
<section id="model" class="level2">
<h2 class="anchored" data-anchor-id="model">4. MODEL</h2>
<p>Recall from our first reading that there are two general types of modeling approaches: unsupervised and supervised machine learning. In Part 4, we focus on supervised learning models, which are used to quantify relationships between features (e.g., motivation and performance) and a known outcome (e.g., student drop out). These models can be used for classification of binary or categorical outcomes, as weâ€™ll illustrate in this section, or regression as weâ€™ll demonstrate in Learning module 2.</p>
<p>Specifically, in Part 4 we will learn how to:</p>
<ol type="1">
<li><p><strong>Split Data</strong> into a training and test set that will be used to develop a predictive model;</p></li>
<li><p><strong>Create a â€œRecipeâ€</strong> for our predictive model and learn how to deal with nominal data that we would like to use as predictors;</p></li>
<li><p><strong>Specify the model and workflow</strong> by selecting the <em>functional form</em> of the model that we want and using a <em>model workflow</em> to pair our model and recipe together;</p></li>
<li><p><strong>Fit Models</strong> to our training set using logistic regression;</p></li>
<li><p><strong>Interpret Accuracy</strong> of our model to see how well our model can â€œpredictâ€ our outcome of interest.</p></li>
</ol>
<section id="step-1.-split-data" class="level3">
<h3 class="anchored" data-anchor-id="step-1.-split-data">Step 1. Split data</h3>
<p>The authors of Data Science in Education Using R (Estrellado et al.,2020) remind us that:</p>
<blockquote class="blockquote">
<p>At its core, machine learning is the process of â€œshowingâ€ your statistical model only some of the data at once and training the model to predict accurately on that training dataset (this is the â€œlearningâ€ part of machine learning). Then, the model as developed on the training data is shown new data - data you had all along, but hid from your computer initially - and you see how well the model that you developed on the training data performs on this new testing data. Eventually, you might use the model on entirely new data.</p>
</blockquote>
<section id="training-and-testing-sets" class="level4">
<h4 class="anchored" data-anchor-id="training-and-testing-sets">Training and Testing Sets</h4>
<p>It is therefore common when beginning a modeling project to <a href="https://bookdown.org/max/FES/data-splitting.html">separate the data set</a> into two partitions:</p>
<ul>
<li><p>The <em>training set</em> is used to estimate, develop and compare models; feature engineering techniques; tune models, etc.</p></li>
<li><p>The <em>test set</em> is held in reserve until the end of the project, at which point there should only be one or two models under serious consideration. It is used as an unbiased source for measuring final model performance.</p></li>
</ul>
<p>There are different ways to create these partitions of the data and there is no uniform guideline for determining how much data should be set aside for testing. The proportion of data can be driven by many factors, including the size of the original pool of samples and the total number of predictors.&nbsp;</p>
<p>After you decide how much to set aside, the most common approach for actually partitioning your data is to use a random sample. For our purposes, weâ€™ll use random sampling to select 20% for the test set and use the remainder for the training set, which are the defaults for the {<a href="https://tidymodels.github.io/rsample/">rsample</a>} package.</p>
</section>
<section id="split-data-sets" class="level4">
<h4 class="anchored" data-anchor-id="split-data-sets">Split Data Sets</h4>
<p>To split our data, we will be using our first {tidymodels} function - <code>initial_split()</code>.</p>
<p>The function <code>initial_split()</code> function from the {rsample} package takes the original data and saves the information on how to make the partitions. The {rsample} package has two aptly named functions for created a training and testing data set called <code>training()</code> and <code>testing()</code>, respectively.</p>
<p>Run the following code to split the data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">20230712</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>train_test_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(students, <span class="at">prop =</span> .<span class="dv">80</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>data_train <span class="ot">&lt;-</span> <span class="fu">training</span>(train_test_split)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>data_test  <span class="ot">&lt;-</span> <span class="fu">testing</span>(train_test_split)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Note</strong>: Since random sampling uses random numbers, it is important to set the random number seed using the <code>set.seed()</code> function. This ensures that the random numbers can be reproduced at a later time (if needed). We pick the first date on which we may carry out this learning module as the seed, but any number will work!</p>
</section>
<section id="your-turn-6" class="level4">
<h4 class="anchored" data-anchor-id="your-turn-6"><strong>ğŸ‘‰ Your Turn</strong> <strong>â¤µ</strong></h4>
<p>Go ahead and type <code>data_train</code> and <code>data_test</code> into the console (in steps) to check that this data set indeed has 80% of the number of observations as in the larger data. Do that in the chunk below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>data_train</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 26,074 Ã— 16
   code_module code_presentation id_student gender region      highest_education
   &lt;chr&gt;       &lt;chr&gt;                  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;       &lt;chr&gt;            
 1 FFF         2014B                 595186 M      South Regiâ€¦ Lower Than A Levâ€¦
 2 BBB         2014J                 504066 F      East Midlaâ€¦ Lower Than A Levâ€¦
 3 BBB         2013J                 585790 F      South Eastâ€¦ HE Qualification 
 4 CCC         2014J                 278413 M      London Regâ€¦ HE Qualification 
 5 GGG         2014B                 634933 F      South Regiâ€¦ Lower Than A Levâ€¦
 6 CCC         2014J                 608577 M      North Regiâ€¦ HE Qualification 
 7 BBB         2014B                 612120 F      East Midlaâ€¦ Lower Than A Levâ€¦
 8 FFF         2013J                 530852 M      Wales       Lower Than A Levâ€¦
 9 CCC         2014J                2555596 M      South Regiâ€¦ A Level or Equivâ€¦
10 DDD         2013B                 556575 M      North Regiâ€¦ HE Qualification 
# â„¹ 26,064 more rows
# â„¹ 10 more variables: imd_band &lt;int&gt;, age_band &lt;chr&gt;,
#   num_of_prev_attempts &lt;dbl&gt;, studied_credits &lt;dbl&gt;, disability &lt;fct&gt;,
#   final_result &lt;chr&gt;, module_presentation_length &lt;dbl&gt;,
#   date_registration &lt;dbl&gt;, date_unregistration &lt;dbl&gt;, pass &lt;fct&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>data_test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,519 Ã— 16
   code_module code_presentation id_student gender region      highest_education
   &lt;chr&gt;       &lt;chr&gt;                  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;       &lt;chr&gt;            
 1 AAA         2013J                  28400 F      Scotland    HE Qualification 
 2 AAA         2013J                  31604 F      South Eastâ€¦ A Level or Equivâ€¦
 3 AAA         2013J                  45462 M      Scotland    HE Qualification 
 4 AAA         2013J                  53025 M      North Regiâ€¦ Post Graduate Quâ€¦
 5 AAA         2013J                  65002 F      East Angliâ€¦ A Level or Equivâ€¦
 6 AAA         2013J                  71361 M      Ireland     HE Qualification 
 7 AAA         2013J                  77367 M      East Midlaâ€¦ A Level or Equivâ€¦
 8 AAA         2013J                  98094 M      Wales       Lower Than A Levâ€¦
 9 AAA         2013J                 111717 F      East Angliâ€¦ HE Qualification 
10 AAA         2013J                 114017 F      North Regiâ€¦ Post Graduate Quâ€¦
# â„¹ 6,509 more rows
# â„¹ 10 more variables: imd_band &lt;int&gt;, age_band &lt;chr&gt;,
#   num_of_prev_attempts &lt;dbl&gt;, studied_credits &lt;dbl&gt;, disability &lt;fct&gt;,
#   final_result &lt;chr&gt;, module_presentation_length &lt;dbl&gt;,
#   date_registration &lt;dbl&gt;, date_unregistration &lt;dbl&gt;, pass &lt;fct&gt;</code></pre>
</div>
</div>
</section>
</section>
<section id="step-2-create-a-recipe" class="level3">
<h3 class="anchored" data-anchor-id="step-2-create-a-recipe">Step 2: Create a â€œRecipeâ€</h3>
<p>In this section, we introduce another tidymodels package named {<a href="https://recipes.tidymodels.org/">recipes</a>}, which is designed to help you prepare your data <em>before</em> training your model. Recipes are built as a series of preprocessing steps, such as:</p>
<ul>
<li><p>converting qualitative predictors to indicator variables (also known as dummy variables),</p></li>
<li><p>transforming data to be on a different scale (e.g., taking the logarithm of a variable),</p></li>
<li><p>transforming whole groups of predictors together,</p></li>
<li><p>extracting key features from raw variables (e.g., getting the day of the week out of a date variable), and so on.</p></li>
</ul>
<p>If you are familiar with Râ€™s formula interface, a lot of this might sound familiar and like what a formula already does. Recipes can be used to do many of the same things, but they have a much wider range of possibilities.</p>
<section id="add-a-formula" class="level4">
<h4 class="anchored" data-anchor-id="add-a-formula"><strong>Add a formula</strong></h4>
<p>To get started, letâ€™s create a recipe for a simple logistic regression model. Before training the model, we can use a recipe.</p>
<p>The <a href="https://recipes.tidymodels.org/reference/recipe.html"><code>recipe()</code>function</a> as we used it here has two arguments:</p>
<ul>
<li><p>A <strong>formula</strong>. Any variable on the left-hand side of the tilde (<code>~</code>) is considered the model outcome (<code>code</code>, in our present case). On the right-hand side of the tilde are the predictors. Variables may be listed by name, or you can use the dot (<code>.</code>) to indicate all other variables as predictors.</p></li>
<li><p>The <strong>data</strong>. A recipe is associated with the data set used to create the model. This will typically be the <em>training</em> set, so <code>data = train_data</code> here. Naming a data set doesnâ€™t actually change the data itself; it is only used to catalog the names of the variables and their types, like factors, integers, dates, etc.</p></li>
</ul>
<p>Letâ€™s create a recipe where we predict <code>pass</code> (the outcome variable) on the basis of the <code>disability</code> and <code>imd_band</code> (predictor) variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>my_rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(pass <span class="sc">~</span> disability <span class="sc">+</span> imd_band, <span class="at">data =</span> data_train)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>my_rec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>â”€â”€ Recipe â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>â”€â”€ Inputs </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Number of variables by role</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>outcome:   1
predictor: 2</code></pre>
</div>
</div>
</section>
</section>
<section id="step-3-specify-the-model-and-workflow" class="level3">
<h3 class="anchored" data-anchor-id="step-3-specify-the-model-and-workflow">Step 3: Specify the model and workflow</h3>
<p>With tidymodels, we start building a model by specifying the <em>functional form</em> of the model that we want using the <a href="https://tidymodels.github.io/parsnip/">{parsnip} package</a>. Since our outcome is binary, the model type we will use is&nbsp;â€œ<a href="https://parsnip.tidymodels.org/reference/logistic_reg.html">logistic regression</a>.â€ We can declare this with <code>logistic_reg()</code> and assign to an object we will later use in our workflow:</p>
<p>Run the following code to finish specifying our model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># specify model</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>my_mod <span class="ot">&lt;-</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logistic_reg</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>That is pretty underwhelming since, on its own, it doesnâ€™t really do much. However, now that the type of model has been specified, a method for&nbsp;<em>fitting</em>&nbsp;or training the model can be stated using the <strong>engine</strong>.</p>
<section id="start-your-engine" class="level4">
<h4 class="anchored" data-anchor-id="start-your-engine"><strong>Start your engine</strong></h4>
<p>To set the <em>engine,</em> letâ€™s rewrite the code above and â€œpipeâ€ in the <code>set_engine("glm")</code> function and <code>set_mode("classification"))</code> to set the â€œ<em>mode</em>â€ to classification. Note that this could also be changed to regression for a continuous/numeric outcome.</p>
<p>Run the following code to finish specifying our model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>my_mod <span class="ot">&lt;-</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logistic_reg</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">%&gt;%</span> <span class="co"># generalized linear model</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="co"># since we are predicting a dichotomous outcome, specify classification; for a number, specify regression</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>my_mod</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Logistic Regression Model Specification (classification)

Computational engine: glm </code></pre>
</div>
</div>
<p>The engine value is often a mash-up of different packages that can be used to fit or train the model as well as the estimation method. For example, we will use â€œglmâ€ a generalized linear model for binary outcomes and default for logistic regression in the {parsnip} package.</p>
</section>
<section id="add-to-workflow" class="level4">
<h4 class="anchored" data-anchor-id="add-to-workflow"><strong>Add to workflow</strong></h4>
<p>Now we can use the recipe created earlier across several steps as we train and test our model. To simplify this process, we can use a <em>model workflow</em>, which pairs a model and recipe together.</p>
<p>This is a straightforward approach because different recipes are often needed for different models, so when a model and recipe are bundled, it becomes easier to train and test&nbsp;<em>workflows</em>.</p>
<p>Weâ€™ll use the{<a href="https://workflows.tidymodels.org/">workflows</a>} package from tidymodels to bundle our parsnip model (<code>lr_mod</code>) with our first recipe (<code>lr_recipe_1</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>my_wf <span class="ot">&lt;-</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">workflow</span>() <span class="sc">%&gt;%</span> <span class="co"># create a workflow</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_model</span>(my_mod) <span class="sc">%&gt;%</span> <span class="co"># add the model we wrote above</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_recipe</span>(my_rec) <span class="co"># add our recipe we wrote above</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="step-4-fit-model" class="level3">
<h3 class="anchored" data-anchor-id="step-4-fit-model">Step 4: Fit model</h3>
<p>Now that we have a single workflow that can be used to prepare the recipe and train the model from the resulting predictors, we can use the <code>fit()</code> function to fit our model to our <code>train_data</code>. And again, we set a random number seed to ensure that if we run this same code again, we will get the same results in terms of the data partition:</p>
<p>Finally, weâ€™ll fit our model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>fitted_model <span class="ot">&lt;-</span> <span class="fu">fit</span>(my_wf, <span class="at">data =</span> data_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="your-turn-7" class="level4">
<h4 class="anchored" data-anchor-id="your-turn-7"><strong>ğŸ‘‰ Your Turn</strong> <strong>â¤µ</strong></h4>
<p>Importantly, here, we can look at the model. Type <code>fitted_model</code> in a code chunk to take a look.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>fitted_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>â•â• Workflow [trained] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Preprocessor: Recipe
Model: logistic_reg()

â”€â”€ Preprocessor â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
0 Recipe Steps

â”€â”€ Model â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Call:  stats::glm(formula = ..y ~ ., family = stats::binomial, data = data)

Coefficients:
(Intercept)  disabilityY     imd_band  
   -0.78655     -0.28186      0.05974  

Degrees of Freedom: 22406 Total (i.e. Null);  22404 Residual
  (3667 observations deleted due to missingness)
Null Deviance:      29830 
Residual Deviance: 29650    AIC: 29660</code></pre>
</div>
</div>
<p>Note that while we donâ€™t typically interpret the coefficients for a machine learning model, itâ€™s important to recognize that many models <em>do</em> produce coefficients we <em>could</em> interpret. Instead, we focus on how the model does with respect to predicting the dependent variable.</p>
<p><strong>Observations</strong></p>
<p>Write down a brief observation of the output above, focusing on the coefficients:</p>
<ul>
<li>YOUR RESPONSE HERE</li>
</ul>
</section>
<section id="the-last_fit-function" class="level4">
<h4 class="anchored" data-anchor-id="the-last_fit-function">The last_fit function</h4>
<p>Finally, weâ€™ll use the <code>last_fit</code> function, which is the key here: note that it uses the <code>train_test_split</code> dataâ€”not just the training data.</p>
<p>Here, then, we fit the data <em>using the training data set</em> and evaluate its accuracy using the <em>testing data set</em> (which is not used to train the model).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>final_fit <span class="ot">&lt;-</span> <span class="fu">last_fit</span>(my_wf, train_test_split)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Type <code>final_fit</code> below; this is the final, fitted modelâ€”one that can be interpreted further in the next step!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>final_fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Resampling results
# Manual resampling 
# A tibble: 1 Ã— 6
  splits               id              .metrics .notes   .predictions .workflow 
  &lt;list&gt;               &lt;chr&gt;           &lt;list&gt;   &lt;list&gt;   &lt;list&gt;       &lt;list&gt;    
1 &lt;split [26074/6519]&gt; train/test splâ€¦ &lt;tibble&gt; &lt;tibble&gt; &lt;tibble&gt;     &lt;workflow&gt;</code></pre>
</div>
</div>
<p>You may see a message/warning above or when you examine <code>final_fit</code>; you can safely ignore that.</p>
</section>
</section>
<section id="step-5-interpret-accuracy" class="level3">
<h3 class="anchored" data-anchor-id="step-5-interpret-accuracy">Step 5: Interpret accuracy</h3>
<p>Run the code below to examine the predictions for the <em>test</em> split of data. Note that the row ID is in the output below, but this doesnâ€™t correspond one-one to the ID variables used in the presentation/Shiny.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># collect test split predictions</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>final_fit <span class="sc">%&gt;%</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">collect_predictions</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,519 Ã— 7
   .pred_class .pred_0 .pred_1 id                .row pass  .config             
   &lt;fct&gt;         &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;            &lt;int&gt; &lt;fct&gt; &lt;chr&gt;               
 1 0             0.647   0.353 train/test split     2 1     Preprocessor1_Model1
 2 0             0.605   0.395 train/test split     4 1     Preprocessor1_Model1
 3 0             0.634   0.366 train/test split     7 1     Preprocessor1_Model1
 4 &lt;NA&gt;         NA      NA     train/test split    10 1     Preprocessor1_Model1
 5 0             0.577   0.423 train/test split    16 0     Preprocessor1_Model1
 6 &lt;NA&gt;         NA      NA     train/test split    18 1     Preprocessor1_Model1
 7 0             0.634   0.366 train/test split    21 1     Preprocessor1_Model1
 8 0             0.577   0.423 train/test split    24 1     Preprocessor1_Model1
 9 0             0.547   0.453 train/test split    33 1     Preprocessor1_Model1
10 &lt;NA&gt;         NA      NA     train/test split    35 1     Preprocessor1_Model1
# â„¹ 6,509 more rows</code></pre>
</div>
</div>
<p>This is our first set of real output! Note two things:</p>
<ol type="1">
<li><code>.pres_class</code>: This is the <em>predicted</em> code<br>
</li>
<li><code>pass</code>: This is the known <em>code</em></li>
</ol>
<p>When these are <strong>the same</strong>, the model predicted the code <em>correctly</em>; when they arenâ€™t the same, the model was incorrect.</p>
<p>Importantly, we can <em>summarize</em> across all of these codes. One way to do this is straightforward; how many of the codes were the same, as in the following chunk of code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>final_fit <span class="sc">%&gt;%</span> </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">collect_predictions</span>() <span class="sc">%&gt;%</span> <span class="co"># see test set predictions</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(.pred_class, pass) <span class="sc">%&gt;%</span> <span class="co"># just to make the output easier to view </span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">correct =</span> .pred_class <span class="sc">==</span> pass) <span class="co"># create a new variable, correct, telling us when the model was and was not correct</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,519 Ã— 3
   .pred_class pass  correct
   &lt;fct&gt;       &lt;fct&gt; &lt;lgl&gt;  
 1 0           1     FALSE  
 2 0           1     FALSE  
 3 0           1     FALSE  
 4 &lt;NA&gt;        1     NA     
 5 0           0     TRUE   
 6 &lt;NA&gt;        1     NA     
 7 0           1     FALSE  
 8 0           1     FALSE  
 9 0           1     FALSE  
10 &lt;NA&gt;        1     NA     
# â„¹ 6,509 more rows</code></pre>
</div>
</div>
<p>You may notice some of the rows may be missing values. This is because there were some missing values in the <code>imd_band</code> variable, and for this machine learning algorithm (the generalized linear model), missing values result in row-wise deletion.</p>
<p>Thatâ€™s helpful, but thereâ€™s one more step we can take â€“ counting up the values of <code>correct</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>final_fit <span class="sc">%&gt;%</span> </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">collect_predictions</span>() <span class="sc">%&gt;%</span> <span class="co"># see test set predictions</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(.pred_class, pass) <span class="sc">%&gt;%</span> <span class="co"># just to make the output easier to view </span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">correct =</span> .pred_class <span class="sc">==</span> pass) <span class="sc">%&gt;%</span> <span class="co"># create a new variable, correct, telling us when the model was and was not correct</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tabyl</span>(correct)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> correct    n   percent valid_percent
   FALSE 2071 0.3176868      0.372549
    TRUE 3488 0.5350514      0.627451
      NA  960 0.1472618            NA</code></pre>
</div>
</div>
<section id="your-turn-8" class="level4">
<h4 class="anchored" data-anchor-id="your-turn-8"><strong>ğŸ‘‰ Your Turn</strong> <strong>â¤µ</strong></h4>
<p>Letâ€™s interpret the above. If the value of <code>correct</code> is <code>TRUE</code> when the predicted and known code are the same, what does the <code>percent</code> column tell us? Add one or more notes to the dashes below:</p>
<ul>
<li>YOUR RESPONSE HERE</li>
</ul>
<p>A short-cut to the above is below; <strong>weâ€™ll use this short-cut from here forward</strong>, having seen how accuracy is calculated.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>final_fit <span class="sc">%&gt;%</span> </span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 Ã— 4
  .metric     .estimator .estimate .config             
  &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               
1 accuracy    binary         0.627 Preprocessor1_Model1
2 roc_auc     binary         0.548 Preprocessor1_Model1
3 brier_class binary         0.232 Preprocessor1_Model1</code></pre>
</div>
</div>
<p>How accurate was our predictive model? Consider how well our model would have done by chance alone â€“ what would the accuracy be in that case (with the model predicting pass one-half of the time)?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>students <span class="sc">%&gt;%</span> </span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(pass)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 Ã— 2
  pass      n
  &lt;fct&gt; &lt;int&gt;
1 0     20232
2 1     12361</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>students <span class="sc">%&gt;%</span> </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">prediction =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="fu">nrow</span>(students), <span class="at">replace =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">correct =</span> <span class="fu">if_else</span>(prediction <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> pass <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>               prediction <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> pass <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tabyl</span>(correct)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> correct     n   percent
       0 16328 0.5009665
       1 16265 0.4990335</code></pre>
</div>
</div>
<p>Curiously, randomly picking a 0 (did not withdraw) or a 1 (pass) will <em>always</em> lead to around a 50% accuracy, regardless of how many observations are actually associated with a 0 or a 1.</p>
<p><strong>Observation</strong></p>
<p>Letâ€™s step back a bit. How well <em>could</em> we do if we include more data? And how <em>useful</em> could such a model be in the real world? Weâ€™ll dive into these questions more over the forthcoming learning labs.</p>
<p>Thatâ€™s it for now; the core parts of machine learning are used in the above steps you took; what weâ€™ll do after this leaning module only adds nuance and complexity to what weâ€™ve already done.</p>
</section>
</section>
</section>
<section id="communicate" class="level2">
<h2 class="anchored" data-anchor-id="communicate">5. COMMUNICATE</h2>
<p>The final step in the workflow/process is sharing the results of your analysis with wider audience. Krumm et al.&nbsp;(2018) have outlined the following 3-step process for communicating with education stakeholders findings from an analysis:</p>
<ol type="1">
<li><p><strong>Select.</strong> Communicating what one has learned involves selecting among those analyses that are most important and most useful to an intended audience, as well as selecting a form for displaying that information, such as a graph or table in static or interactive form, i.e.&nbsp;a â€œdata product.â€</p></li>
<li><p><strong>Polish</strong>. After creating initial versions of data products, research teams often spend time refining or polishing them, by adding or editing titles, labels, and notations and by working with colors and shapes to highlight key points.</p></li>
<li><p><strong>Narrate.</strong> Writing a narrative to accompany the data products involves, at a minimum, pairing a data product with its related research question, describing how best to interpret the data product, and explaining the ways in which the data product helps answer the research question.</p></li>
</ol>
<p>For your learning ML Learning module 1 Badge, you will have an opportunity to create a simple â€œdata productâ€ designed to illustrate insights some insights gained from your model and ideally highlight an â€œaction stepâ€ that can be taken to act upon your findings.</p>
<section id="your-turn-9" class="level4">
<h4 class="anchored" data-anchor-id="your-turn-9"><strong>ğŸ‘‰ Your Turn</strong> <strong>â¤µ</strong></h4>
<p>For now, we will wrap up this case study by converting our work into a webpage that can be used to communicate your learning and demonstrate some of your new R skills. To do so, you will need to â€œknitâ€ your document by clicking the <img src="img/Screenshot%202023-06-28%20at%204.14.22%20PM.png" class="img-fluid" style="width:10.0%"> button in the menu bar at the the top of this file. This will do two things; it will:</p>
<ol type="1">
<li><p>check through all your code for any errors; and,</p></li>
<li><p>create a file in your directory that you can use to share you work through <a href="https://posit.cloud/learn/guide#publish-from-cloud">Posit Cloud</a> (see screenshot example below to publish), <a href="#0">RPubs</a> , <a href="#0">GitHub Pages</a>, <a href="#0">Quarto Pub</a>, or any <a href="#0">other methods</a>.</p></li>
</ol>
<p><strong>Note:</strong> Before knitting, make sure you change the <code>author:</code> name in the YAML header at the top of this document so you can take credit for your hard work!</p>
<ol type="1">
<li></li>
</ol>
<p><img src="img/knit-publish.png" class="img-fluid" style="width:80.0%"></p>
<p>Congratulations - youâ€™ve completed the first machine learning case study!</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>